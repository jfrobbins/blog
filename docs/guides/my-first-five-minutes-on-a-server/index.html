<!doctype html>
<html lang="en-us">
  <head>
    <title>My First Five Minutes on a Server // jrobb.org</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.129.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Jon Robbins" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css" />
    

    
  


    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="My First Five Minutes on a Server">
  <meta name="twitter:description" content="I’ve been going through some of my backups and came across this post that I (used to) use all the time.
I originally grabbed this a long time ago from plusbryan.com, but now it appears to be down… so I’m glad I saved it.
my_first_5mins_on_a_server.pdf Thanks, PlusBryan, whoever you are – this has saved me a lot of time over the years!
Here is the post in its entirety (made with a little help from grok):">

    <meta property="og:url" content="https://jrobb.org/guides/my-first-five-minutes-on-a-server/">
  <meta property="og:site_name" content="jrobb.org">
  <meta property="og:title" content="My First Five Minutes on a Server">
  <meta property="og:description" content="I’ve been going through some of my backups and came across this post that I (used to) use all the time.
I originally grabbed this a long time ago from plusbryan.com, but now it appears to be down… so I’m glad I saved it.
my_first_5mins_on_a_server.pdf Thanks, PlusBryan, whoever you are – this has saved me a lot of time over the years!
Here is the post in its entirety (made with a little help from grok):">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="guides">
    <meta property="article:published_time" content="2024-12-12T15:53:08-05:00">
    <meta property="article:modified_time" content="2024-12-12T15:53:08-05:00">
    <meta property="article:tag" content="Server">
    <meta property="article:tag" content="Guides">


  </head>
  <body>
    <header class="app-header">
      <a href="https://jrobb.org/"><img class="app-header-avatar" src="/images/avatars/rm/grok-me-rm-style-2.jpg" alt="Jon Robbins" /></a>
      <span class="app-header-title">jrobb.org</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             / 
          
          <a class="app-header-menu-item" href="/categories/">Categories</a>
             / 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             / 
          
          <a class="app-header-menu-item" href="/quotes/">Quotes</a>
             / 
          
          <a class="app-header-menu-item" href="/tags/guides/">Guides</a>
             / 
          
          <a class="app-header-menu-item" href="/recipes/">Recipes</a>
             / 
          
          <a class="app-header-menu-item" href="/tags/iamyourfather/">Dad Stuff</a>
             / 
          
          <a class="app-header-menu-item" href="/about/">About</a>
             / 
          
          <a class="app-header-menu-item" href="/contact/">Contact</a>
      </nav>
      <p>Just my random thoughts</p>
      <div class="app-header-social">
        
          <a href="https://mastodon.social/@jrobb" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-mastodon" viewBox="0 0 24 24" fill="currentColor"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg>
          </a>
        
          <a href="https://x.com/jrobbnc" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-x" viewBox="0 0 24 24" fill="currentColor"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg>
          </a>
        
          <a href="https://github.com/jfrobbins" target="_blank" rel="noreferrer noopener me">
            <svg class="icon icon-brand-github" viewBox="0 0 24 24" fill="currentColor"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">My First Five Minutes on a Server</h1>
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Dec 12, 2024
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          6 min read
        </div>
        <div>
          <svg class="icon icon-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
              <a class="tag" href="https://jrobb.org/tags/server/">Server</a>
              <a class="tag" href="https://jrobb.org/tags/guides/">Guides</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>I&rsquo;ve been going through some of my backups and came across this post that I (used to) use all the time.</p>
<p>I originally grabbed this a long time ago from <a href="https://plusbryan.com">plusbryan.com</a>, but now it appears to be down&hellip; so I&rsquo;m glad I saved it.</p>
<ul>
<li><a href="/docs/my_first_5mins_on_a_server.pdf">my_first_5mins_on_a_server.pdf</a></li>
</ul>
<p>Thanks, PlusBryan, whoever you are &ndash; this has saved me a lot of time over the years!</p>
<p>Here is the post in its entirety (<a href="https://x.com/i/grok/share/yxlyM0Es4W124KC8zOAkJHuj4">made with a little help from grok</a>):</p>
<blockquote>
<h1 id="my-first-5-minutes-on-a-server-or-essential-security-for-linux-servers"><strong>My First 5 Minutes On A Server; Or, Essential Security for Linux Servers</strong></h1>
<p>Server security doesn&rsquo;t need to be complicated. My security philosophy is simple: adopt principles that will protect you from the most frequent attack vectors, while keeping administration efficient enough that you won&rsquo;t develop &ldquo;security cruft&rdquo;. If you use your first 5 minutes on a server wisely, I believe you can do that.</p>
<p>Any seasoned sysadmin can tell you that as you grow and add more servers &amp; developers, user administration inevitably becomes a burden. Maintaining conventional access grants in the environment of a fast growing startup is an uphill battle - you&rsquo;re bound to end up with stale passwords, abandoned intern accounts, and a myriad of &ldquo;I have sudo access to Server A, but not Server B&rdquo; issues. There are account sync tools to help mitigate this pain, but IMO the incremental benefit isn&rsquo;t worth the time nor the security downsides. Simplicity is the heart of good security.</p>
<p>Our servers are configured with two accounts: root and deploy. The deploy user has sudo access via an arbitrarily long password and is the account that developers log into. Developers log in with their public keys, not passwords, so administration is as simple as keeping the authorized_keys file up-to-date across servers. Root login over ssh is disabled, and the deploy user can only log in from our office IP block.</p>
<p>The downside to our approach is that if an authorized_keys file gets clobbered or mis-permissioned, I need to log into the remote terminal to fix it (Linode offers something called Lish, which runs in the browser). If you take appropriate caution, you shouldn&rsquo;t need to do this.</p>
<p>Note: I&rsquo;m not advocating this as the most secure approach - just that it balances security and management simplicity for our small team. From my experience, most security breaches are caused either by insufficient security procedures or sufficient procedures poorly maintained.</p>
<p><strong>Let&rsquo;s Get Started</strong></p>
<p>Our box is freshly hatched, virgin pixels at the prompt. I favor Ubuntu; if you use another version of linux, your commands may vary. Five minutes to go:</p>
<pre tabindex="0"><code>passwd
</code></pre><p>Change the root password to something long and complex. You won&rsquo;t need to remember it, just store it somewhere secure - this password will only be needed if you lose the ability to log in over ssh or lose your sudo password.</p>
<pre tabindex="0"><code>apt-get update
apt-get upgrade
</code></pre><p>The above gets us started on the right foot.</p>
<p><strong>Install Fail2ban</strong></p>
<pre tabindex="0"><code>apt-get install fail2ban
</code></pre><p>Fail2ban is a daemon that monitors login attempts to a server and blocks suspicious activity as it occurs. It&rsquo;s well configured out of the box.</p>
<p>Now, let&rsquo;s set up your login user. Feel free to name the user something besides &lsquo;deploy&rsquo;, it&rsquo;s just a convention we use:</p>
<pre tabindex="0"><code>useradd deploy
mkdir /home/deploy
mkdir /home/deploy/.ssh
chmod 700 /home/deploy/.ssh
</code></pre><p><strong>Require public key authentication</strong></p>
<p>The days of passwords are over. You&rsquo;ll enhance security and ease of use in one fell swoop by ditching those passwords and employing public key authentication for your user accounts.</p>
<pre tabindex="0"><code>vim /home/deploy/.ssh/authorized_keys
</code></pre><p>Add the contents of the id_rsa.pub on your local machine and any other public keys that you want to have access to this server to this file.</p>
<pre tabindex="0"><code>chmod 400 /home/deploy/.ssh/authorized_keys
chown deploy:deploy /home/deploy -R
</code></pre><p><strong>Test The New User &amp; Enable Sudo</strong></p>
<p>Now test your new account logging into your new server with the deploy user (keep the terminal window with the root login open). If you&rsquo;re successful, switch back to the terminal with the root user active and set a sudo password for your login user:</p>
<pre tabindex="0"><code>passwd deploy
</code></pre><p>Set a complex password - you can either store it somewhere secure or make it something memorable to the team. This is the password you&rsquo;ll use to sudo.</p>
<pre tabindex="0"><code>visudo
</code></pre><p>Comment all existing user/group grant lines and add:</p>
<pre tabindex="0"><code>root ALL=(ALL) ALL
deploy ALL=(ALL) ALL
</code></pre><p>The above grants sudo access to the deploy user when they enter the proper password.</p>
<p><strong>Lock Down SSH</strong></p>
<p>Configure ssh to prevent password &amp; root logins and lock ssh to particular IPs:</p>
<pre tabindex="0"><code>vim /etc/ssh/sshd_config
</code></pre><p>Add these lines to the file, inserting the ip address from where you will be connecting:</p>
<pre tabindex="0"><code>PermitRootLogin no
PasswordAuthentication no
AllowUsers deploy@(your-ip) deploy@(another-ip-if-any)
</code></pre><p>Now restart ssh:</p>
<pre tabindex="0"><code>service ssh restart
</code></pre><p><strong>Set Up A Firewall</strong></p>
<p>No secure server is complete without a firewall. Ubuntu provides ufw, which makes firewall management easy. Run:</p>
<pre tabindex="0"><code>ufw allow from {your-ip} to any port 22
ufw allow 80
ufw allow 443
ufw enable
</code></pre><p>This sets up a basic firewall and configures the server to accept traffic over port 80 and 443. You may wish to add more ports depending on what your server is going to do.</p>
<p><strong>Enable Automatic Security Updates</strong></p>
<p>I&rsquo;ve gotten into the apt-get update/upgrade habit over the years, but with a dozen servers, I found that servers I logged into less frequently weren&rsquo;t staying as fresh. Especially with load-balanced machines, it&rsquo;s important that they all stay up to date. Automated security updates scare me somewhat, but not as badly as unpatched security holes.</p>
<pre tabindex="0"><code>apt-get install unattended-upgrades
vim /etc/apt/apt.conf.d/10periodic
</code></pre><p>Update the file to look like this:</p>
<pre tabindex="0"><code>APT::Periodic::Update-Package-Lists &#34;1&#34;;
APT::Periodic::Download-Upgradeable-Packages &#34;1&#34;;
APT::Periodic::AutocleanInterval &#34;7&#34;;
APT::Periodic::Unattended-Upgrade &#34;1&#34;;
</code></pre><p>One more config file to edit:</p>
<pre tabindex="0"><code>vim /etc/apt/apt.conf.d/50unattended-upgrades
</code></pre><p>Update the file to look like below. You should probably keep updates disabled and stick with security updates only:</p>
<pre tabindex="0"><code>Unattended-Upgrade::Allowed-Origins {
    &#34;Ubuntu lucid-security&#34;;
    // &#34;Ubuntu lucid-updates&#34;;
};
</code></pre><p><strong>Install Logwatch To Keep An Eye On Things</strong></p>
<p>Logwatch is a daemon that monitors your logs and emails them to you. This is useful for tracking and detecting intrusion. If someone were to access your server, the logs that are emailed to you will be helpful in determining what happened and when - as the logs on your server might have been compromised.</p>
<pre tabindex="0"><code>apt-get install logwatch
vim /etc/cron.daily/00logwatch
</code></pre><p>add this line:</p>
<pre tabindex="0"><code>/usr/sbin/logwatch --output mail --mailto test@gmail.com --detail high
</code></pre><p><strong>All Done!</strong></p>
<p>I think we&rsquo;re at a solid place now. In just a few minutes, we&rsquo;ve locked down a server and set up a level of security that should repel most attacks while being easy to maintain. At the end of the day, it&rsquo;s almost always user error that causes break-ins, so make sure you keep those passwords long and safe!</p>
<p>I&rsquo;d love to hear your feedback on this approach! Feel free to discuss on Hacker News or follow me on Twitter.</p>
<p><strong>Update</strong></p>
<p>There&rsquo;s a great discussion happening over at Hacker News. Thanks for all the good ideas and helpful advice! As our infrastructure grows, I definitely plan on checking out Puppet or Chef - they sound like great tools for simplifying multi-server infrastructure management. If you&rsquo;re on Linode like us, the above can be accomplished via StackScripts as well.</p>
</blockquote>
<h1 id="mirror">mirror</h1>
<p><a href="https://gist.github.com/jfrobbins/7300697ec882a681d77fd1384b3d5570">github gist of the article</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
